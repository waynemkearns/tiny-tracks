# Deployment Guide

## Deploying to Render (Recommended - Free Tier Available)

TinyTracks runs as a traditional Node.js server (not serverless) for better performance and session management.

### Quick Deploy

1. **Push code to GitHub** (if not already done)

2. **Go to [Render Dashboard](https://dashboard.render.com/)**

3. **Create New Web Service**
   - Click "New +" → "Web Service"
   - Connect your GitHub repository
   - Select the `tinytracks` repository

4. **Render will auto-detect the `render.yaml` configuration**

5. **Set Environment Variables in Render Dashboard:**
   - `DATABASE_URL` - Your Neon PostgreSQL connection string
   - `SESSION_SECRET` will be auto-generated
   - Optional: `SENTRY_DSN`, `PLAUSIBLE_DOMAIN`

6. **Deploy!**
   - Render will automatically build and deploy
   - Your app will be live at `https://tinytracks.onrender.com` (or your custom domain)

### Environment Variables

Required:
- `DATABASE_URL` - PostgreSQL connection string from Neon
- `SESSION_SECRET` - Auto-generated by Render or set manually
- `NODE_ENV=production` - Auto-set by Render

Optional:
- `SENTRY_DSN` - For error tracking
- `PLAUSIBLE_DOMAIN` - For analytics

### Build Process

The deployment runs:
1. `npm ci` - Clean install dependencies
2. `npm run build` - Build frontend (Vite) and backend (esbuild)
3. `npm start` - Start the production server on PORT provided by Render

### Database Setup

After first deployment:

```bash
# Set your Render service URL
export RENDER_URL=https://tinytracks.onrender.com

# The database tables are created automatically via sessions
# But you may want to seed initial data:
npm run db:push  # Run locally to push schema
npm run db:seed  # Run locally to seed data
```

### Custom Domain

1. Go to your service settings in Render
2. Click "Custom Domains"
3. Add your domain and follow DNS instructions

### Monitoring

- Render provides automatic health checks
- View logs in Render dashboard
- Set up Sentry for error tracking (optional)

---

## Alternative: Deploying to Railway

1. Go to [Railway](https://railway.app/)
2. Click "New Project" → "Deploy from GitHub repo"
3. Select your repository
4. Railway will auto-detect Node.js
5. Set environment variables in Railway dashboard
6. Deploy!

---

## Local Development

```bash
# Install dependencies
npm install

# Set up environment variables
cp env.example .env
# Edit .env with your DATABASE_URL

# Push database schema
npm run db:push

# Seed database (optional)
npm run db:seed

# Start development server
npm run dev
```

Server runs on `http://localhost:5000`

---

## Troubleshooting

### Build Fails
- Check that all environment variables are set
- Verify `DATABASE_URL` is accessible from Render's servers
- Check build logs in Render dashboard

### Database Connection Issues
- Ensure `DATABASE_URL` is correct
- Check that Neon database allows connections from Render IPs
- Verify database is not paused (Neon free tier auto-pauses)

### App Not Loading
- Check service logs in Render dashboard
- Verify PORT environment variable is being used (auto-set by Render)
- Ensure build completed successfully

### Sessions Not Working
- Verify `SESSION_SECRET` is set
- Check that `connect-pg-simple` can create session table
- Verify database connection is stable

